<!DOCTYPE html>
<html id="1">

<head>
    <title>Events - Mechanism</title>
    <link rel="stylesheet" href="../tutorial.css" media="all" type="text/css" />
    <link rel="stylesheet" href="../tree.css" media="all" type="text/css" />
    <link rel="stylesheet" href="../callout.css" media="all" type="text/css" />
    <style>
        .border {
            border: 1px solid gray;
            border-radius: 6px;
        }

        .dotted-border {
            border: 2px dashed gray;
            border-radius: 6px;
            background-color: white;
        }
    </style>

</head>

<body id="2">
    <div id="fb-root"></div>
    <script>
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s);
            js.id = id;
            js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.3&appId=752510261471542";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
    </script>
    <!-- Place this tag in your head or just before your close body tag. -->
    <script src="https://apis.google.com/js/platform.js" async defer></script>

    <header>
        <h1>Event flow - Mechanism</h1>
        <div style="position:relative; padding-bottom:10px;">
            <div style="position:absolute; left:0px">

                <div class="fb-like" data-href="http://sanjay1909.github.io/Tutorials/events" data-layout="button_count" data-action="like" data-show-faces="true" data-share="true"></div>

            </div>
            <div style="position:absolute; right:0px">
                <div class="g-plusone" data-size="medium" data-href="http://sanjay1909.github.io/Tutorials/events/index.html"></div>
                <div class="g-plus" data-action="share" data-annotation="bubble" data-href="http://sanjay1909.github.io/Tutorials/events/index.html"></div>
            </div>
        </div>

    </header>
    <section id="3">
        <br/>
        <div style="padding:6px;margin:4px;">Some of the Important properties to be considered in event flow are
            <ul>
                <li>Target (DOM element, where Event occured)</li>
                <li>CurrentTarget DOM element, where eventlistener function is getting called)</li>
                <li>Phase (Order in which event Listeners are executed)</li>

                <ul>
                    <li>Bubble-Phase (Second phase(default) - from leaf to root)</li>
                    <li>Capture-Phase (First phase from root to leaf)</li>
                </ul>

            </ul>
        </div>
        </br>
        </br>
        <div style='text-align:center'>
            <div id="4" class="hdiv dotted-border" style='height:80px; padding:40px;overflow:hidden'>
                <div class="border" id="5" style='height:100%;margin:auto;text-align:center'>
                    <input id="6" type="button" value="Button" style="display:block; margin:0 100px;position:relative;top:45%"></input>
                </div>
            </div>
            <div class='hdiv border' style='height:80px;padding:40px;overflow:hidden;text-align:left'>
                <div>
                    <input id="captureCheckBox" type="checkbox">Capture Phase</input>
                    </br>
                    <input id="bubbleCheckBox" type="checkbox">Bubble Phase</input>
                </div>
                </br>
                <div>
                    <span><b>Target</b>: <span id="tar">null</span></span>
                    </br>
                    <span><b>Current Target</b>: <span id="ct">null</span>
                    </span>
                </div>
            </div>
        </div>

        <div style="text-align:center;margin:20px">
            <div class="border" style="display:inline-block">
                <div class="hdiv" style="backgroundColor:white;display:inline-block;" id="capture">
                    <p>DOM Tree: Capturing Phase</p>
                    <div class="tree" id="captureTree">
                        <ul>
                            <li>
                                <a href="#" id="captureElm1">document</a>
                                <ul>
                                    <li>
                                        <a href="#" id="captureElm2">body</a>
                                        <ul>
                                            <li>
                                                <a href="#">header</a>
                                                <ul>
                                                    <li>
                                                        <a href="#">h1</a>
                                                    </li>
                                                    <li>
                                                        <a href="#">div</a>
                                                    </li>
                                                </ul>
                                            </li>
                                            <li>
                                                <a href="#" id="captureElm3">section</a>
                                                <ul>
                                                    <li>
                                                        <a href="#" id="captureElm4">div (dashed)</a>
                                                        <ul>
                                                            <li>
                                                                <a href="#" id="captureElm5">div</a>
                                                                <ul>
                                                                    <li>
                                                                        <a href="#">span</a>
                                                                    </li>
                                                                    <li>
                                                                        <a href="#" id="captureElm6">Button</a>
                                                                    </li>

                                                                </ul>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                </ul>
                                            </li>

                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>

                    </div>
                </div>
                <div class="hdiv" style="backgroundColor:white;display:inline-block;" id="bubble">
                    <p>DOM Tree: Bubbling Phase</p>
                    <div class="tree" id="bubbleTree">
                        <ul>
                            <li>
                                <a href="#" id="bubbleElm1">document</a>
                                <ul>
                                    <li>
                                        <a href="#" id="bubbleElm2">body</a>
                                        <ul>
                                            <li>
                                                <a href="#">header</a>
                                                <ul>
                                                    <li>
                                                        <a href="#">div</a>
                                                    </li>
                                                </ul>
                                            </li>
                                            <li>
                                                <a href="#" id="bubbleElm3">section</a>
                                                <ul>
                                                    <li>
                                                        <a href="#" id="bubbleElm4">div (dashed)</a>
                                                        <ul>
                                                            <li>
                                                                <a href="#" id="bubbleElm5">div</a>
                                                                <ul>
                                                                    <li>
                                                                        <a href="#">span</a>
                                                                    </li>
                                                                    <li>
                                                                        <a href="#" id="bubbleElm6">Button</a>
                                                                    </li>

                                                                </ul>
                                                            </li>
                                                        </ul>
                                                    </li>
                                                </ul>
                                            </li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>



        <div id="summary" class="bubble me" style="position: absolute;display:none">Hi</div>

    </section>


    <footer>
        <div class="thank-you">
            <div class="fb-comments" style="margin-left:auto;margin-right:auto" data-href="http://sanjay1909.github.io/Tutorials/events/mouse/index.html" data-numposts="5" data-colorscheme="light"></div>
        </div>


    </footer>


    <script>
        (function (i, s, o, g, r, a, m) {
            i['GoogleAnalyticsObject'] = r;
            i[r] = i[r] || function () {
                (i[r].q = i[r].q || []).push(arguments)
            }, i[r].l = 1 * new Date();
            a = s.createElement(o),
                m = s.getElementsByTagName(o)[0];
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m)
        })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');

        ga('create', 'UA-63657805-1', 'auto');
        ga('send', 'pageview');
    </script>

    <script>
        function addEvent(el, event, handler, useCapture) {
            if (!el) {
                return;
            }
            if (el.attachEvent) {
                el.attachEvent('on' + event, handler);
            } else if (el.addEventListener) {
                el.addEventListener(event, handler, useCapture);
            } else {
                el['on' + event] = handler;
            }
        }


        function updateTraceUI(currentTarget, target, phase, reset) {
            var ele = document.getElementById(phase + String(currentTarget.id));
            ele.style.color = "000";
            var curColor = "white";


            if (reset) {
                ele.style.backgroundColor = curColor;
                summary.style.display = 'none';
                return;
            }

            if (phase === 'bubbleElm' && !bubbleCheckBox.checked) {
                curColor = "#c8e4f8";
                ele.style.backgroundColor = curColor;
                summary.style.display = 'none';
                return;
            }

            if (phase === 'captureElm' && !captureCheckBox.checked) {
                curColor = "#c8e4f8";
                ele.style.backgroundColor = curColor;
                summary.style.display = 'none';
                return;
            }

            if (currentTarget.id === '4') {
                //yellow
                curColor = "#ffff93";
                ct.textContent = 'Div in Yellow Color'
            } else if (currentTarget.id === '5') {
                //green
                curColor = "#c8f8d3";
                ct.textContent = 'Div in Green Color'
            } else if (currentTarget.id === '6') {
                //pink
                curColor = "#f8c8de";
                ct.textContent = 'Div in Pink Color'
            } else {
                curColor = "#c8e4f8";
                ct.textContent = 'null (as No event-listener attached)'
            }
            // if(currentTarget === target )
            ele.style.backgroundColor = curColor;
            summary.style.display = 'none';
            ct.innerHTML = 'null';
        }



        function updateElementUI(currentTarget, target, phase, reset) {
            var curColor = 'white';
            var colorName = 'white';
            var curTarName = 'null';

            if (reset) {
                currentTarget.style.backgroundColor = curColor;
                summary.style.display = 'none';
                return;
            }

            var ele = document.getElementById(phase + 'Elm' + String(currentTarget.id));
            var divTree = document.getElementById(phase + 'Tree');

            var top = currentTarget.offsetTop + 5;
            var left = currentTarget.offsetLeft + currentTarget.clientWidth;

            if (currentTarget.id === '4') {
                //yellow
                curColor = "#ffff93";
                colorName = 'yellow';
                curTarName = '<i>Dotted - DIV</i>';
            } else if (currentTarget.id === '5') {
                //green
                curColor = "#c8f8d3";
                colorName = 'green';
                curTarName = '<i>DIV</i>';
            } else if (currentTarget.id === '6') {
                //pink
                curColor = "#f8c8de";
                colorName = 'pink';
                top = top - 5;
                curTarName = '<i>Button</i>';
            }
            currentTarget.style.backgroundColor = curColor;
            ele.style.backgroundColor = curColor;

            summary.style.display = 'block';
            summary.innerHTML = '<u>Executing Event-listener:</u></br>Turning DOM element background to <b>' + colorName + '</b> color.';
            summary.style.top = top + 'px';
            summary.style.left = left + 'px';
            ct.innerHTML = curTarName;
        }



        function createCaptureTrace(depth) {
            for (var i = 1; i <= depth; i++) {
                var e = document.getElementById(String(i));
                setTimeout(function () {
                    updateTraceUI(arguments[0], arguments[0], 'captureElm', false);
                }.bind(e, e), captureTraceTime);
                captureTraceTime = captureTraceTime + traceDelta;
            }
        }




        var traceDelta = 1000;
        var listenerDelta = 3000;

        var captureTraceCount = 0;
        var bubbleTraceCount = 0;

        var captureTraceTime = 0;
        var captureListenerTime = 0;
        var bubbleTraceTime = 0;
        var bubbleListenerTime = 0;

        var totalBubbleListenerTime = 0;
        var totalCaptureTraceTime = 0;

        function createCaptureTimer(e) {
            var depth = Number(e.target.id);

            //execute only once
            if (e.target.id === e.currentTarget.id) {
                resetAll();
                if (captureCheckBox.checked) captureTraceCount = 3;
                else captureTraceCount = depth;

                createCaptureTrace(captureTraceCount);
                totalCaptureTraceTime = captureTraceCount * traceDelta - traceDelta;

                if (captureCheckBox.checked) {
                    captureListenerTime = totalCaptureTraceTime + ((depth - 3) * listenerDelta);
                    bubbleListenerTime = listenerDelta; // when we start bublelistner we need to add delta

                } else {
                    captureListenerTime = totalCaptureTraceTime + ((depth - 3) * traceDelta);
                    bubbleListenerTime = traceDelta;
                }

                bubbleTraceTime = captureListenerTime; //update Trace time for bubble trace
                bubbleListenerTime = bubbleListenerTime + bubbleTraceTime;

                if (bubbleCheckBox.checked) {
                    bubbleTraceTime = bubbleListenerTime + ((depth - 3) * listenerDelta);
                } else {
                    bubbleTraceTime = bubbleListenerTime + ((depth - 3) * traceDelta);
                }

                if (bubbleCheckBox.checked) bubbleTraceCount = 3;
                else bubbleTraceCount = depth;

                createBubbleTrace(bubbleTraceCount);


                if (e.target.id === "4") tar.innerHTML = '<u>Dotted Div</u>';
                else if (e.target.id === "5") tar.innerHTML = '<u>Div</u>';
                else if (e.target.id === "6") tar.innerHTML = '<u>Button</u>';
            }

            if (captureCheckBox.checked) {
                setTimeout(function () {
                    updateElementUI(arguments[0], arguments[1], 'capture', false);
                }.bind(e, e.currentTarget, e.target), captureListenerTime);
                captureListenerTime = captureListenerTime - listenerDelta;
            }

            if (bubbleCheckBox.checked) {
                setTimeout(function () {
                    updateElementUI(arguments[0], arguments[1], 'bubble', false);
                }.bind(e, e.currentTarget, e.target), bubbleListenerTime);
                bubbleListenerTime = bubbleListenerTime + listenerDelta;
            }
        }

        function createBubbleTrace(depth) {
            for (var i = depth; i > 0; i--) {
                var e = document.getElementById(String(i));
                setTimeout(function () {
                    updateTraceUI(arguments[0], arguments[0], 'bubbleElm', false);
                }.bind(e, e), bubbleTraceTime);
                bubbleTraceTime = bubbleTraceTime + traceDelta;
            }
        }




        function resetAll() {
            for (var i = 1; i <= 6; i++) {
                var ele = document.getElementById(String(i));
                updateTraceUI(ele, ele, 'captureElm', true);
                updateTraceUI(ele, ele, 'bubbleElm', true);
            }
            for (var i = 6; i > 3; i--) {
                var ele = document.getElementById(String(i));
                updateElementUI(ele, ele, 'capture', true);
                updateElementUI(ele, ele, 'bubble', true);
            }
            captureTraceCount = 0;
            bubbleTraceCount = 0;

            captureTraceTime = 0;
            captureListenerTime = 0;
            bubbleTraceTime = 0;
            bubbleListenerTime = 0;

            totalBubbleListenerTime = 0;
            totalCaptureTraceTime = 0;
        }



        function addListeners() {
            for (var i = 6; i > 3; i--) {
                var ele = document.getElementById(String(i));
                addEvent(ele, 'click', createCaptureTimer, false);
            }
        }

        addListeners();
    </script>


</body>

</html>
